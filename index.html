<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ… ã‚¯ãƒªã‚¹ãƒã‚¹ãƒãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆæ³¨æ–‡ãƒ•ã‚©ãƒ¼ãƒ  ğŸ</title>
<style>
  :root {
    --bg:#fff8f8;
    --card:#ffffff;
    --border:#e5e5e5;
    --txt:#222;
    --muted:#777;
    --accent-red:#e63946;
    --accent-green:#2a9d8f;
    --btn-shadow:0 4px 8px rgba(0,0,0,0.15);
  }

  body {
    margin:0;
    background:var(--bg);
    font-family: "Nunito", "ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN", "Meiryo", sans-serif;
    color:var(--txt);
  }

  .wrap {
    max-width:480px;
    margin:0 auto;
    padding:16px;
  }

  .card {
    background:var(--card);
    border-radius:16px;
    padding:24px;
    box-shadow:0 4px 12px rgba(0,0,0,.08);
    border:3px solid var(--accent-green);
    background-image: radial-gradient(circle at top left, #fff5f5, #f9fffa);
  }

  h1 {
    text-align:center;
    font-size:22px;
    color:var(--accent-red);
    margin-bottom:12px;
  }

  h1::after {
    content: "ğŸ„";
    display:block;
    font-size:28px;
    margin-top:4px;
  }

  .row {
    margin:18px 0;
  }

  label {
    font-weight:600;
    font-size:15px;
    color:var(--accent-green);
  }

  input[type="text"], textarea {
    width:100%;
    padding:10px 12px;
    border:2px solid var(--accent-green);
    border-radius:10px;
    font-size:16px;
    box-sizing:border-box;
    background:#fff;
  }

  textarea {
    min-height:80px;
    resize:vertical;
  }

  .cat {
    border:2px dashed var(--accent-green);
    border-radius:12px;
    padding:12px;
    margin-top:14px;
    background:#fffefa;
  }

  .cat h3 {
    margin:0;
    font-size:18px;
    color:var(--accent-red);
    display:flex;
    align-items:center;
    justify-content:space-between;
  }

  .cat input[type="checkbox"] {
    width:22px;
    height:22px;
    accent-color: var(--accent-green);
  }

  .items {
    display:grid;
    grid-template-columns:1fr auto;
    gap:10px 8px;
    margin-top:8px;
  }

  .item-name {
    font-size:15px;
  }

  .qty {
    width:64px;
    padding:6px;
    font-size:15px;
    border:1px solid var(--border);
    border-radius:8px;
    text-align:center;
  }

  .muted {
    color:var(--muted);
    font-size:12px;
    margin-top:4px;
  }

  .btn {
    width:100%;
    background:linear-gradient(135deg, var(--accent-red), var(--accent-green));
    color:#fff;
    border:none;
    padding:14px;
    border-radius:12px;
    font-size:18px;
    cursor:pointer;
    box-shadow:var(--btn-shadow);
    transition:.2s;
  }

  .btn:hover {
    filter:brightness(1.1);
  }

  #result {
    margin-top:16px;
    font-weight:700;
    text-align:center;
    color:var(--accent-green);
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>ã”æ³¨æ–‡ãƒ•ã‚©ãƒ¼ãƒ </h1>
    <div class="row">
      <label for="customerId">ãŠå®¢æ§˜ç•ªå·ï¼ˆåŠè§’æ•°å­—ï¼‰</label>
      <input type="text" id="customerId" inputmode="numeric" pattern="[0-9]+" placeholder="ä¾‹: 123" required />
      <div class="muted">â€»åŠè§’æ•°å­—ã®ã¿ã€‚è‹±å­—ãƒ»å…¨è§’ã¯ä¸å¯ã€‚</div>
    </div>

    <!-- ã‚«ãƒ†ã‚´ãƒªï¼šãƒã‚§ãƒƒã‚¯ã§è©³ç´°ã‚’é–‹ã -->
    <div id="categories"></div>

    <div class="row">
      <label for="note">å‚™è€ƒï¼ˆä»»æ„ï¼‰</label>
      <textarea id="note" placeholder="ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã€æä¾›ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãªã©è‡ªç”±ã«è¨˜è¿°ãã ã•ã„"></textarea>
    </div>

    <button class="btn" id="submitBtn">ğŸ é€ä¿¡ ğŸ…</button>
    <div id="result"></div>
  </div>
</div>

<script>
/** â˜…ã“ã“ã«GASã®Webã‚¢ãƒ—ãƒªURLï¼ˆ/execï¼‰ã‚’è²¼ã‚‹ */
const GAS_URL = "https://mute-forest-8746.matsuno12199.workers.dev/";

/** ä¾¡æ ¼å®šç¾©ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆè¡¨ç¤ºç”¨ï¼‰ã€‚æœ€çµ‚è¨ˆç®—ã¯ã‚µãƒ¼ãƒãŒå†è¨ˆç®—ã—ã¾ã™ */
const PRICES = {
  'ã‚½ãƒ•ãƒˆãƒ‰ãƒªãƒ³ã‚¯': { 'ã‚³ãƒ¼ãƒ©': 600, 'çƒé¾èŒ¶': 600, 'ã‚ªãƒ¬ãƒ³ã‚¸ã‚¸ãƒ¥ãƒ¼ã‚¹': 600, 'ã‚¸ãƒ³ã‚¸ãƒ£ãƒ¼ã‚¨ãƒ¼ãƒ«': 600 },
  'ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«': { 'ç”Ÿãƒ“ãƒ¼ãƒ«': 800, 'ãƒã‚¤ãƒœãƒ¼ãƒ«': 800, 'ã‚«ã‚·ã‚¹ã‚ªãƒ¬ãƒ³ã‚¸': 800 },
  'æ¨ã—æ’®ï¼ã‚¹ãƒšãƒ‰ãƒª': { 'æ¨ã—æ’®ï¼ã‚¹ãƒšãƒ‰ãƒª': 2000 },
  'æ¨ã—æ’®ï¼ï¼ï¼ãƒŸãƒ‹ã‚·ãƒ£ãƒ³': { 'æ¨ã—æ’®ï¼ï¼ï¼ãƒŸãƒ‹ã‚·ãƒ£ãƒ³': 5000 },
  'é¡”é¢ãƒ—ãƒªãƒ³ãƒˆã‚·ãƒ£ãƒ³ãƒ‘ãƒ³': { 'é¡”é¢ãƒ—ãƒªãƒ³ãƒˆã‚·ãƒ£ãƒ³ãƒ‘ãƒ³': 15000 },
  'é¡”é¢ãƒ—ãƒªãƒ³ãƒˆã‚·ãƒ£ãƒ³ãƒ¡ãƒªãƒ¼': { 'é¡”é¢ãƒ—ãƒªãƒ³ãƒˆã‚·ãƒ£ãƒ³ãƒ¡ãƒªãƒ¼': 15000 }
};

// ã‚«ãƒ†ã‚´ãƒªæ§‹ç¯‰
const categoriesEl = document.getElementById('categories');

function renderCategory(name, itemsObj) {
  const hasDetails = Object.keys(itemsObj).length > 1 || name === 'ã‚½ãƒ•ãƒˆãƒ‰ãƒªãƒ³ã‚¯' || name === 'ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«';

  const cat = document.createElement('div');
  cat.className = 'cat';

  const h = document.createElement('h3');
  const checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.id = `cat-${name}`;
  h.appendChild(checkbox);
  const label = document.createElement('span');
  label.textContent = name;
  h.appendChild(label);
  cat.appendChild(h);

  // æ˜ç´°ã‚¨ãƒªã‚¢
  const items = document.createElement('div');
  items.className = 'items';
  items.style.display = 'none';

  // æ˜ç´°è¡Œï¼ˆæ•°é‡å…¥åŠ›ï¼‰
  for (const itemName of Object.keys(itemsObj)) {
    const price = itemsObj[itemName];

    const nameEl = document.createElement('div');
    nameEl.className = 'item-name';
    nameEl.textContent = `${itemName} Â¥${price}`;

    const qty = document.createElement('input');
    qty.type = 'number';
    qty.min = '0';
    qty.value = '0';
    qty.className = 'qty';
    qty.dataset.category = name;
    qty.dataset.name = itemName;

    items.appendChild(nameEl);
    items.appendChild(qty);
  }
  cat.appendChild(items);

  if (!hasDetails) items.style.display = 'grid';

  checkbox.addEventListener('change', () => {
    items.style.display = checkbox.checked ? 'grid' : 'none';
    if (!checkbox.checked) {
      items.querySelectorAll('input[type="number"]').forEach(inp => inp.value = '0');
    }
  });

  categoriesEl.appendChild(cat);
}

for (const catName of Object.keys(PRICES)) {
  renderCategory(catName, PRICES[catName]);
}

// é€ä¿¡
document.getElementById('submitBtn').addEventListener('click', async () => {
  const customerId = document.getElementById('customerId').value.trim();
  if (!/^\d+$/.test(customerId)) {
    alert('ãŠå®¢æ§˜ç•ªå·ã¯åŠè§’æ•°å­—ã®ã¿ã§ã™');
    return;
  }

  const orders = [];
  document.querySelectorAll('.qty').forEach(inp => {
    const qty = Number(inp.value || 0);
    if (qty > 0) {
      const category = inp.dataset.category;
      const name = inp.dataset.name;
      orders.push({ category, name, qty });
    }
  });

  if (orders.length === 0) {
    alert('æ³¨æ–‡ãŒã‚ã‚Šã¾ã›ã‚“');
    return;
  }

  const note = document.getElementById('note').value.trim();

  try {
    const res = await fetch(GAS_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ customerId, orders, note })
    });
    const json = await res.json();
    if (json.success) {
      document.getElementById('result').innerHTML =
        `ğŸ‰ <b>ä»Šå›ã®åˆè¨ˆï¼š</b> Â¥${Number(json.thisTotal).toLocaleString()}<br>` +
        `ğŸ’° <b>ã“ã‚Œã¾ã§ã®ç´¯è¨ˆï¼š</b> Â¥${Number(json.cumulative).toLocaleString()}`;
    } else {
      document.getElementById('result').textContent = 'ã‚¨ãƒ©ãƒ¼ï¼š' + (json.error || 'unknown');
    }
  } catch (err) {
    document.getElementById('result').textContent = 'é€šä¿¡ã‚¨ãƒ©ãƒ¼ï¼š' + err.message;
  }
});
</script>
</body>
</html>
